# ============================================================================
# Zelda 2B — MMC3 (Mapper 4) Linker Configuration — SCAFFOLD
# ============================================================================
# Minimal config for bootstrap: just enough to build a valid NES ROM.
# Full 256KB PRG / 256KB CHR bank layout will be expanded by the Tech thread.
#
# For now: 256KB PRG (filled), 256KB CHR (filled), battery-backed SRAM.
# Only the two fixed banks ($C000-$FFFF) contain code; rest is padding.
# ============================================================================

MEMORY {
    # 16-byte iNES 2.0 header
    HEADER:       start = $0000, size = $0010, type = ro, fill = yes, file = %O;

    # Internal RAM
    ZP:           start = $0000, size = $0100, type = rw;
    STACK:        start = $0100, size = $0100, type = rw;
    OAM:          start = $0200, size = $0100, type = rw;
    RAM:          start = $0300, size = $0500, type = rw;
    SRAM:         start = $6000, size = $2000, type = rw;

    # PRG ROM — 32 x 8KB = 256KB
    # Banks 0-29: switchable, currently empty padding
    PRG_PAD_LO:   start = $8000, size = $3C000, type = ro, fill = yes, file = %O;
    # Bank 30: fixed at $C000 (PRG_FIXED_C)
    PRG_FIXED_C:  start = $C000, size = $2000,  type = ro, fill = yes, file = %O;
    # Bank 31: fixed at $E000 (PRG_FIXED_E) — contains vectors
    PRG_FIXED_E:  start = $E000, size = $1FFA,  type = ro, fill = yes, file = %O;
    VECTORS_MEM:  start = $FFFA, size = $0006,  type = ro, fill = yes, file = %O;

    # CHR ROM — 256 x 1KB = 256KB, all padding for now
    CHR_PAD:      start = $0000, size = $40000, type = ro, fill = yes, file = %O;
}

SEGMENTS {
    HEADER:       load = HEADER,       type = ro;
    ZEROPAGE:     load = ZP,           type = zp;
    STACK:        load = STACK,        type = bss, optional = yes;
    OAM:          load = OAM,          type = bss;
    RAM:          load = RAM,          type = bss;
    SRAM:         load = SRAM,         type = bss, optional = yes;

    # Switchable PRG banks — all padding for now
    PRG_PADDING:  load = PRG_PAD_LO,   type = ro, optional = yes;

    # Fixed code banks
    PRG_FIXED_C:  load = PRG_FIXED_C,  type = ro;
    PRG_FIXED:    load = PRG_FIXED_E,  type = ro;
    VECTORS:      load = VECTORS_MEM,  type = ro;

    # CHR ROM — all padding for now
    CHR_PADDING:  load = CHR_PAD,      type = ro, optional = yes;
}
